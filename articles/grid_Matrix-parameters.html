<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Grid_Matrix parameters â€¢ antaresWaterValues</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Grid_Matrix parameters">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">antaresWaterValues</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/computation_watervalues.html">Watervalues computation</a></li>
    <li><a class="dropdown-item" href="../articles/grid_Matrix-parameters.html">Grid_Matrix parameters</a></li>
    <li><a class="dropdown-item" href="../articles/Reward-interpolation.html">Reward interpolation method</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rte-antares-rpackage/antaresWaterValues/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Grid_Matrix parameters</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rte-antares-rpackage/antaresWaterValues/blob/main/vignettes/grid_Matrix-parameters.Rmd" class="external-link"><code>vignettes/grid_Matrix-parameters.Rmd</code></a></small>
      <div class="d-none name"><code>grid_Matrix-parameters.Rmd</code></div>
    </div>

    
    
<p>This article explains the different parameters on the function
<code><a href="../reference/Grid_Matrix.html">Grid_Matrix()</a></code> and how to use them.</p>
<div class="section level2">
<h2 id="initialize-study-and-reward-functions">Initialize study and reward functions<a class="anchor" aria-label="anchor" href="#initialize-study-and-reward-functions"></a>
</h2>
<p>First of all, load the package and compute reward functions through
simulations :</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rte-antares-rpackage.github.io/antaresWaterValues/">antaresWaterValues</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opts</span> <span class="op">&lt;-</span> <span class="fu">antaresRead</span><span class="fu">::</span><span class="fu"><a href="https://rte-antares-rpackage.github.io/antaresRead/reference/setSimulationPath.html" class="external-link">setSimulationPath</a></span><span class="op">(</span><span class="st">"your/path/to/the/antares/study"</span>,<span class="st">"input"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">area</span> <span class="op">&lt;-</span> <span class="st">"area"</span></span>
<span><span class="va">pumping</span> <span class="op">&lt;-</span> <span class="cn">T</span> <span class="co">#T if pumping possible</span></span>
<span><span class="va">mcyears</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span> <span class="co"># Monte Carlo years you want to use</span></span>
<span><span class="va">efficiency</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getPumpEfficiency.html">getPumpEfficiency</a></span><span class="op">(</span><span class="va">area</span>,opts<span class="op">=</span><span class="va">opts</span><span class="op">)</span></span>
<span><span class="va">name</span> <span class="op">=</span> <span class="st">"3sim"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulation_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runWaterValuesSimulation.html">runWaterValuesSimulation</a></span><span class="op">(</span></span>
<span>    area<span class="op">=</span><span class="va">area</span>,</span>
<span>    nb_disc_stock <span class="op">=</span> <span class="fl">3</span>, <span class="co">#number of simulations</span></span>
<span>    mcyears <span class="op">=</span> <span class="va">mcyears</span>,</span>
<span>    path_solver <span class="op">=</span> <span class="st">"your/path/to/antares/bin/antares-8.6-solver.exe"</span>,</span>
<span>    opts <span class="op">=</span> <span class="va">opts</span>,</span>
<span>    otp_dest<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">opts</span><span class="op">$</span><span class="va">studyPath</span>,<span class="st">"/user"</span><span class="op">)</span>,</span>
<span>    file_name<span class="op">=</span><span class="va">name</span>, <span class="co">#name of the saving file</span></span>
<span>    pumping<span class="op">=</span><span class="va">pumping</span>,</span>
<span>    efficiency<span class="op">=</span><span class="va">efficiency</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Now compute reward functions :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reward_db</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_Reward.html">get_Reward</a></span><span class="op">(</span></span>
<span>  simulation_names <span class="op">=</span> <span class="va">simulation_res</span><span class="op">$</span><span class="va">simulation_names</span>,</span>
<span>  simulation_values <span class="op">=</span> <span class="va">simulation_res</span><span class="op">$</span><span class="va">simulation_values</span>,</span>
<span>  opts<span class="op">=</span><span class="va">opts</span>,</span>
<span>  area <span class="op">=</span> <span class="va">area</span>,</span>
<span>  mcyears <span class="op">=</span> <span class="va">mcyears</span>,</span>
<span>  efficiency <span class="op">=</span> <span class="va">efficiency</span>,</span>
<span>  method_old <span class="op">=</span> <span class="cn">T</span>,</span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: 'memory.limit()' is Windows-specific</span></span>
<span><span class="va">reward</span> <span class="op">&lt;-</span> <span class="va">reward_db</span><span class="op">$</span><span class="va">reward</span></span></code></pre></div>
<p>Define default parameters :</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">states_step_ratio</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">20</span></span>
<span><span class="va">penalty_low</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="va">penalty_high</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="va">force_final_level</span> <span class="op">=</span> <span class="cn">F</span></span>
<span><span class="va">penalty_final_level</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="va">final_level</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_initial_level.html">get_initial_level</a></span><span class="op">(</span>area<span class="op">=</span><span class="va">area</span>,opts<span class="op">=</span><span class="va">opts</span><span class="op">)</span></span>
<span><span class="va">nb_cycle</span> <span class="op">=</span> <span class="fl">1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="number-of-states">Number of states<a class="anchor" aria-label="anchor" href="#number-of-states"></a>
</h2>
<p>The parameter <code>states_step_ratio</code>, that gives the space
between two state levels in the Bellman computation, can be decreased to
have more precise results but this will also increase computational
time.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_states</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">s</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">compare_states</span> <span class="op">=</span> <span class="fu"><a href="../reference/Grid_Matrix.html">Grid_Matrix</a></span><span class="op">(</span></span>
<span>    area<span class="op">=</span><span class="va">area</span>,</span>
<span>    reward_db <span class="op">=</span> <span class="va">reward_db</span>,</span>
<span>    mcyears <span class="op">=</span> <span class="va">mcyears</span>,</span>
<span>    states_step_ratio <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="va">s</span>,</span>
<span>    opts <span class="op">=</span> <span class="va">opts</span>,</span>
<span>    efficiency<span class="op">=</span><span class="va">efficiency</span>,</span>
<span>    penalty_low <span class="op">=</span> <span class="va">penalty_low</span>,</span>
<span>    penalty_high <span class="op">=</span> <span class="va">penalty_high</span>,</span>
<span>    force_final_level <span class="op">=</span> <span class="va">force_final_level</span>,</span>
<span>    final_level <span class="op">=</span> <span class="va">final_level</span>,</span>
<span>    penalty_final_level_low <span class="op">=</span> <span class="va">penalty_final_level</span>,</span>
<span>    penalty_final_level_high <span class="op">=</span> <span class="va">penalty_final_level</span>,</span>
<span>    nb_cycle <span class="op">=</span> <span class="va">nb_cycle</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">aggregated_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>number_states <span class="op">=</span> <span class="va">s</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">compare_states</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_state-1.png" width="100%"><img src="grid_Matrix-parameters_files/figure-html/compare_state-2.png" width="100%"><img src="grid_Matrix-parameters_files/figure-html/compare_state-3.png" width="100%"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">weeks</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">12</span>,<span class="fl">22</span>,<span class="fl">32</span>,<span class="fl">42</span>,<span class="fl">52</span><span class="op">)</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">vu</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>number_states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">number_states</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">states</span>, y <span class="op">=</span> <span class="va">vu</span>, color <span class="op">=</span> <span class="va">number_states</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">weeks</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_state_vu-1.png" width="100%"></p>
<p>Variations of water values are more detailed with 50 states than 10.
In this example, 20 states seem to be enough to represent the variation
of water values.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_states</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">weeks</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>number_states <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">number_states</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">states</span>, y <span class="op">=</span> <span class="va">value_node</span>, color <span class="op">=</span> <span class="va">number_states</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_state_bellman-1.png" width="100%"></p>
<p>The difference between bellman values with 10 states and 20 states is
quite important in this example. With 10 states, bellman values are
lower because the linear interpolation of bellman values underestimates
real bellman values.</p>
</div>
<div class="section level2">
<h2 id="cvar-value">Cvar value<a class="anchor" aria-label="anchor" href="#cvar-value"></a>
</h2>
<p>Bellman values can be computed with 2 different formulas :</p>
<ul>
<li>
<code>cvar_value = 1</code> : At the end of each week in the
backward recursion, for each state compute the mean of Bellman values
over the scenarios. This method computed the minimum of the expectancy
of weekly costs with the constraint that the hazards of the following
week are not yet known. Use this method to minimize costs.</li>
<li>
<code>cvar_value &lt; 1</code> : Similar to
<code>cvar_value = 1</code> but instead of the mean over all scenarios,
take the mean over <code>cvar_value</code> percent of the worst
scenarios for each week. Use this method to avoid years with high costs
and in particular to minimize the unsupplied energy. The value
<code>cvar_value</code> can be adapted to be more or less cautious.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_method</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">compare_method</span> <span class="op">=</span> <span class="fu"><a href="../reference/Grid_Matrix.html">Grid_Matrix</a></span><span class="op">(</span></span>
<span>    area<span class="op">=</span><span class="va">area</span>,</span>
<span>    reward_db <span class="op">=</span> <span class="va">reward_db</span>,</span>
<span>    mcyears <span class="op">=</span> <span class="va">mcyears</span>,</span>
<span>    states_step_ratio <span class="op">=</span> <span class="va">states_step_ratio</span>,</span>
<span>    cvar_value <span class="op">=</span> <span class="va">m</span>,</span>
<span>    opts <span class="op">=</span> <span class="va">opts</span>,</span>
<span>    efficiency<span class="op">=</span><span class="va">efficiency</span>,</span>
<span>    penalty_low <span class="op">=</span> <span class="va">penalty_low</span>,</span>
<span>    penalty_high <span class="op">=</span> <span class="va">penalty_high</span>,</span>
<span>    force_final_level <span class="op">=</span> <span class="va">force_final_level</span>,</span>
<span>    final_level <span class="op">=</span> <span class="va">final_level</span>,</span>
<span>    penalty_final_level_low <span class="op">=</span> <span class="va">penalty_final_level</span>,</span>
<span>    penalty_final_level_high <span class="op">=</span> <span class="va">penalty_final_level</span>,</span>
<span>    nb_cycle <span class="op">=</span> <span class="va">nb_cycle</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">aggregated_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cvar_value <span class="op">=</span> <span class="va">m</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">compare_method</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_method-1.png" width="100%"><img src="grid_Matrix-parameters_files/figure-html/compare_method-2.png" width="100%"><img src="grid_Matrix-parameters_files/figure-html/compare_method-3.png" width="100%"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_method</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cvar_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cvar_value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">weeks</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">12</span>,<span class="fl">22</span>,<span class="fl">32</span>,<span class="fl">42</span>,<span class="fl">52</span><span class="op">)</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">vu</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">states</span>, y <span class="op">=</span> <span class="va">vu</span>, color <span class="op">=</span> <span class="va">cvar_value</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">weeks</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_method_vu-1.png" width="100%"></p>
<p>Smaller <code>cvar_value</code> gives higher water values and
therefore more conservative levels trajectories.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_method</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cvar_value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cvar_value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">weeks</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">states</span>, y <span class="op">=</span> <span class="va">value_node</span>, color <span class="op">=</span> <span class="va">cvar_value</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_method_bellman-1.png" width="100%"></p>
<p>Bellman values with small <code>cvar_value</code> method are smaller
as they take into account for each week, the worst scenarios so they
overestimate the total cost.</p>
</div>
<div class="section level2">
<h2 id="respect-of-rule-curves">Respect of rule curves<a class="anchor" aria-label="anchor" href="#respect-of-rule-curves"></a>
</h2>
<p>In case, there is rule curves in the storage, penalties on bottom and
top rule curves can be used to encourage storage levels to stay inside
rule curves. The value of <code>penalty_low</code> (in euros/MWh) should
be chosen with respect to thermal clusters cost and to unsupplied cost,
depending if it is better to use expensive thermal cluster or to not
respect the lower rule curve. On the opposite, <code>penalty_high</code>
should be chosen with respect of the spillage cost.</p>
<p>Penalties are added in the computation of Bellman values on the
future level (at the end of the week) and also added at the end of the
algorithm in the initial level (at the beginning of the week) :</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>V</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munder><mo>max</mo><mrow><mi>U</mi><mo>âˆˆ</mo><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>U</mi><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msup><mo>,</mo><msup><mi>U</mi><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msup><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><msub><mi>X</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>=</mo><msub><mi>X</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>U</mi><mi>t</mi></msub><mo>+</mo><msub><mi>I</mi><mi>t</mi></msub><mo>,</mo><msub><mi>X</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo>âˆˆ</mo><mrow><mo stretchy="true" form="prefix">[</mo><msubsup><mi>X</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msubsup><mo>,</mo><msubsup><mi>X</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow><mrow><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msubsup><mo stretchy="true" form="postfix">]</mo></mrow></mrow></munder><msub><mi>G</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>t</mi></msub><mo>,</mo><msub><mi>U</mi><mi>t</mi></msub><mo>,</mo><msub><mi>W</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>V</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>P</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mrow><mi>t</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
V_t(X_t) = \max_{U \in [U^{min},U^{max}],X_{t+1}=X_t-U_t+I_t,X_{t+1} \in [X_{t+1}^{min},X_{t+1}^{max}]} G_t(X_t,U_t,W_t) + V_{t+1}(X_{t+1}) + P_{t+1}(X_{t+1})
</annotation></semantics></math><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mi>V</mi><mi>t</mi><mrow><mi>f</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>l</mi></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>V</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><msub><mi>P</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
V^{final}_t(X_t) =V_t(X_t) + P_t(X_{t})
</annotation></semantics></math> With the penalty defined as :</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>t</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>min</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msub><mi>p</mi><mrow><mi>l</mi><mi>o</mi><mi>w</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>X</mi><mi>t</mi></msub><mo>âˆ’</mo><msub><munder><mi>X</mi><mo accent="true">_</mo></munder><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><msub><mi>p</mi><mrow><mi>h</mi><mi>i</mi><mi>g</mi><mi>h</mi></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mover><mi>X</mi><mo accent="true">Â¯</mo></mover><mi>t</mi></msub><mo>âˆ’</mo><msub><mi>X</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
P_t(X_{t}) = \min(0, p_{low}(X_t-\underline{X}_t), p_{high}(\overline{X}_t-X_t))
</annotation></semantics></math></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_rulecurve</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">p</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">150</span>,<span class="fl">500</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">compare_rulecurve</span> <span class="op">=</span> <span class="fu"><a href="../reference/Grid_Matrix.html">Grid_Matrix</a></span><span class="op">(</span></span>
<span>    area<span class="op">=</span><span class="va">area</span>,</span>
<span>    reward_db <span class="op">=</span> <span class="va">reward_db</span>,</span>
<span>    mcyears <span class="op">=</span> <span class="va">mcyears</span>,</span>
<span>    states_step_ratio <span class="op">=</span> <span class="va">states_step_ratio</span>,</span>
<span>    opts <span class="op">=</span> <span class="va">opts</span>,</span>
<span>    efficiency<span class="op">=</span><span class="va">efficiency</span>,</span>
<span>    penalty_low <span class="op">=</span> <span class="va">p</span>,</span>
<span>    penalty_high <span class="op">=</span> <span class="va">p</span>,</span>
<span>    force_final_level <span class="op">=</span> <span class="va">force_final_level</span>,</span>
<span>    final_level <span class="op">=</span> <span class="va">final_level</span>,</span>
<span>    penalty_final_level_low <span class="op">=</span> <span class="va">penalty_final_level</span>,</span>
<span>    penalty_final_level_high <span class="op">=</span> <span class="va">penalty_final_level</span>,</span>
<span>    nb_cycle <span class="op">=</span> <span class="va">nb_cycle</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">aggregated_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="va">p</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">compare_rulecurve</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_rulecurve-1.png" width="100%"><img src="grid_Matrix-parameters_files/figure-html/compare_rulecurve-2.png" width="100%"><img src="grid_Matrix-parameters_files/figure-html/compare_rulecurve-3.png" width="100%"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_rulecurve</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">weeks</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">12</span>,<span class="fl">22</span>,<span class="fl">32</span>,<span class="fl">42</span>,<span class="fl">52</span><span class="op">)</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">vu</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>penalty <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">penalty</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">states</span>, y <span class="op">=</span> <span class="va">vu</span>, color <span class="op">=</span> <span class="va">penalty</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">weeks</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_rulecurve_vu-1.png" width="100%"></p>
<p>Higher the penalty on rule curves are, higher the water values are
below the lower rule curve and lower the water values are above the
higher rule curve. This will help the storage to remain inside rule
curves. On weeks on the beginning the year, there are different levels
of water values reflecting that it can take more than one week to get
back inside rule curves. Thanks to dynamic programming, water values are
able to anticipate the respect of future rule curves.</p>
</div>
<div class="section level2">
<h2 id="respect-of-final-level">Respect of final level<a class="anchor" aria-label="anchor" href="#respect-of-final-level"></a>
</h2>
<p>As for the respect of rule curves, it is possible to encourage the
storage to end the year at a specific level thanks to penalties. The
option <code>force_final_level</code> must be <code>TRUE</code>. The
wanted final level is specified with parameter <code>final_level</code>.
Specific values of penalties are used for the final week and are given
by <code>penalty_final_level_low</code> and
<code>penalty_final_level_high</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">=</span> <span class="fu"><a href="../reference/Grid_Matrix.html">Grid_Matrix</a></span><span class="op">(</span></span>
<span>  area<span class="op">=</span><span class="va">area</span>,</span>
<span>  reward_db <span class="op">=</span> <span class="va">reward_db</span>,</span>
<span>  mcyears <span class="op">=</span> <span class="va">mcyears</span>,</span>
<span>  states_step_ratio <span class="op">=</span> <span class="va">states_step_ratio</span>,</span>
<span>  opts <span class="op">=</span> <span class="va">opts</span>,</span>
<span>  efficiency<span class="op">=</span><span class="va">efficiency</span>,</span>
<span>  penalty_low <span class="op">=</span> <span class="va">penalty_low</span>,</span>
<span>  penalty_high <span class="op">=</span> <span class="va">penalty_high</span>,</span>
<span>  force_final_level <span class="op">=</span> <span class="cn">T</span>,</span>
<span>  final_level <span class="op">=</span> <span class="va">final_level</span>,</span>
<span>  penalty_final_level_low <span class="op">=</span> <span class="fl">3000</span>,</span>
<span>  penalty_final_level_high <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  nb_cycle <span class="op">=</span> <span class="va">nb_cycle</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_finallevel-1.png" width="100%"></p>
<p>Water values will encourage the storage to end at the specified final
level thanks to their cone shape.</p>
</div>
<div class="section level2">
<h2 id="number-of-cycles">Number of cycles<a class="anchor" aria-label="anchor" href="#number-of-cycles"></a>
</h2>
<p>By default, final bellman values are equal to zero. This means that
unless the final level is forced, there is no value in keeping storage
at the end of the year. To avoid this and if the final level is not
fixed, it is possible to do several computation of Bellman values to
estimate final Bellman values and to use then at the end of the horizon.
Empirically, 2 iterations is enough.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_cycle</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">n</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">compare_cycle</span> <span class="op">=</span> <span class="fu"><a href="../reference/Grid_Matrix.html">Grid_Matrix</a></span><span class="op">(</span></span>
<span>    area<span class="op">=</span><span class="va">area</span>,</span>
<span>    reward_db <span class="op">=</span> <span class="va">reward_db</span>,</span>
<span>    mcyears <span class="op">=</span> <span class="va">mcyears</span>,</span>
<span>    states_step_ratio <span class="op">=</span> <span class="va">states_step_ratio</span>,</span>
<span>    opts <span class="op">=</span> <span class="va">opts</span>,</span>
<span>    efficiency<span class="op">=</span><span class="va">efficiency</span>,</span>
<span>    penalty_low <span class="op">=</span> <span class="va">penalty_low</span>,</span>
<span>    penalty_high <span class="op">=</span> <span class="va">penalty_high</span>,</span>
<span>    force_final_level <span class="op">=</span> <span class="va">force_final_level</span>,</span>
<span>    final_level <span class="op">=</span> <span class="va">final_level</span>,</span>
<span>    penalty_final_level_low <span class="op">=</span> <span class="va">penalty_final_level</span>,</span>
<span>    penalty_final_level_high <span class="op">=</span> <span class="va">penalty_final_level</span>,</span>
<span>    nb_cycle <span class="op">=</span> <span class="va">n</span></span>
<span>  <span class="op">)</span><span class="op">$</span><span class="va">aggregated_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nb_cycle <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">compare_cycle</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_cycle-1.png" width="100%"><img src="grid_Matrix-parameters_files/figure-html/compare_cycle-2.png" width="100%"><img src="grid_Matrix-parameters_files/figure-html/compare_cycle-3.png" width="100%"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_cycle</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">weeks</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">12</span>,<span class="fl">22</span>,<span class="fl">32</span>,<span class="fl">42</span>,<span class="fl">52</span><span class="op">)</span>,<span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">vu</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>nb_cycle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">nb_cycle</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">states</span>, y <span class="op">=</span> <span class="va">vu</span>, color <span class="op">=</span> <span class="va">nb_cycle</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">weeks</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="grid_Matrix-parameters_files/figure-html/compare_cycle_vu-1.png" width="100%"></p>
<p>With only one cycle, water values are lower at the end of the year
because, with null final bellman values,the optimal solution is to use
all the storage left. With two cycles, water values are higher. At the
beginning of the year, water values are similar so in this example (and
in most cases), two cycles are enough.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dhia Gharsallaoui, Juliette Gerbaux.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

# Calculate water values with `Grid_Matrix` from estimated reward, used in `calculateBellmanWithIterativeSimulations`

Calculate water values with `Grid_Matrix` from estimated reward, used in
`calculateBellmanWithIterativeSimulations`

## Usage

``` r
updateWatervalues(
  reward,
  controls,
  area,
  mcyears,
  opts,
  states_step_ratio,
  pump_eff,
  penalty_low,
  penalty_high,
  inflow,
  niveau_max,
  max_hydro_weekly,
  cvar_value = 1,
  force_final_level = FALSE,
  final_level = NULL,
  penalty_final_level = NULL
)
```

## Arguments

- reward:

  Data frame containing estimation of the reward function, same format
  as the output of `reward_offset`, not yet offseted with respect to 0

- controls:

  Data frame containing possible transition for each week, generated by
  the function `constraint_generator`

- area:

  Area with the reservoir

- mcyears:

  Vector of monte carlo years used to evaluate rewards

- opts:

  List of simulation parameters returned by the function
  [`antaresRead::setSimulationPath`](https://rte-antares-rpackage.github.io/antaresRead/reference/setSimulationPath.html)

- states_step_ratio:

  Discretization ratio to generate steps levels between the reservoir
  capacity and zero

- pump_eff:

  Pumping efficiency between 0 and 1 (1 if no pumping)

- penalty_low:

  Penalty for violating the bottom rule curve

- penalty_high:

  Penalty for violating the top rule curve

- inflow:

  Data frame with inflows for each week and each scenario, generated by
  the function
  [`antaresRead::readInputTS`](https://rte-antares-rpackage.github.io/antaresRead/reference/readInputTS.html)

- niveau_max:

  Capacity of the reservoir in MWh

- max_hydro_weekly:

  data.frame `timeId,pump,turb` with maximum pumping and storing powers
  for each week,returned by the function `get_max_hydro`

- cvar_value:

  from 0 to 1. the probability used in quantile method to determine a
  bellman value which cvar_value all bellman values are equal or less to
  it. (quantile(cvar_value))

- force_final_level:

  Binary. Whether final level should be constrained

- final_level:

  Final level (in percent between 0 and 100) if final level is
  constrained but different from initial level

- penalty_final_level:

  Penalties (for both bottom and top rule curves) to constrain final
  level

## Value

List containing aggregated water values and the data table with all
years
